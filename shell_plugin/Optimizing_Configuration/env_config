######################
#LA/NMP环境信息检测收集

#此文件用于保存系统的配置信息，这些基本信息包括安装了哪些软件，软件的版本号，安装位置，配置文件的位置
#使用了哪些模块，做了哪些配置。相当于是整个系统配置的一个信息列表。我们在开发其他的功能时，都将依据这个文件的信息来做判断。
#这个文件的配置也将定期进行更新。
######################

#脚本执行前使用 dos2unix 进行转换

#使用apachectl验证配置文件的正确性

#我们是通过判断httpd.conf是否存在及所在路径判断apache
{
	'SYSTEM':{
'OS_version':
'OS_bit':
			}
	
	'APACHE_BASE':{
'Apache_Install':
'Apache_Install_Way':
'Apache_Rpm_Version':
'Apache_Make_Version':
'Apache_Rpm_Installation_Directory':
'Apache_Make_Installation_Directory':
'Apache_Rpm_Conf_Path':
'Apache_Make_Conf_Path':
'Apache_Rpm_Start_Cmd':
'Apache_Make_Start_Cmd':
'Apache_Rpm_Stop_Cmd':
'Apache_Make_Stop_Cmd':
'Apache_Rpm_Restart_Cmd':
'Apache_Make_Restart_Cmd':
			}
			
	'APACHE_OPTIONS':{
'Apache_Rpm_ServerTokens':
'Apache_Rpm_ServerRoot':
'Apache_Rpm_PidFile':
'Apache_Rpm_Timeout':
'Apache_Rpm_KeepAlive':
'Apache_Rpm_MaxKeepAliveRequests':
'Apache_Rpm_KeepAliveTimeout':
'Apache_Rpm_Listen':
'Apache_Rpm_User':
'Apache_Rpm_Group':
'Apache_Rpm_ServerAdmin':
'Apache_Rpm_UseCanonicalName':
'Apache_Rpm_DocumentRoot':
'Apache_Rpm_HostnameLookups':
'Apache_Rpm_ErrorLog':
'Apache_Rpm_ServerSignature':
'Apache_Rpm_LogLevel':
'Apache_Rpm_Log_Segmentation':
'Apache_Rpm_Vhost'
'Apache_Rpm_Vhost_Conf':
'Apache_Make_ServerTokens':
'Apache_Make_ServerRoot':
'Apache_Make_PidFile':
'Apache_Make_Timeout':
'Apache_Make_KeepAlive':
'Apache_Make_MaxKeepAliveRequests':
'Apache_Make_KeepAliveTimeout':
'Apache_Make_Listen':
'Apache_Make_User':
'Apache_Make_Group':
'Apache_Make_ServerAdmin':
'Apache_Make_UseCanonicalName':
'Apache_Make_DocumentRoot':
'Apache_Make_HostnameLookups':
'Apache_Make_ErrorLog':
'Apache_Make_ServerSignature':
'Apache_Make_LogLevel':
'Apache_Make_Log_Segmentation':
'Apache_Make_Vhost'
'Apache_Make_Vhost_Conf':
			}
			
	'APACHE_MODULES':{
'Apache_Rpm_mod_status':
'Apache_Rpm_mod_expires':
'Apache_Rpm_mod_security':
'Apache_Rpm_libphp5':
'Apache_Rpm_ssl':
'Apache_Make_mod_status':
'Apache_Make_mod_expires':
'Apache_Make_mod_security':
'Apache_Make_libphp5':
'Apache_Make_ssl':
			}
	
	'NGINX_BASE':{
'Nginx_Install':
'Nginx_Install_Way':
'Nginx_Rpm_Version':
'Nginx_Make_Version':
'Nginx_Rpm_Installation_Directory':
'Nginx_Make_Installation_Directory':
'Nginx_Rpm_Conf_Path':
'Nginx_Make_Conf_Path':
'Nginx_Rpm_Start_Cmd':
'Nginx_Make_Start_Cmd':
'Nginx_Rpm_Stop_Cmd':
'Make_Stop_Cmd':
'Nginx_Rpm_Restart_Path':
'Nginx_Make_Restart_Path':
			}
			
	'NGINX_OPTIONS':{
'Apache_Rpm_ServerTokens':
'Apache_Rpm_ServerRoot':
'Apache_Rpm_PidFile':
'Apache_Rpm_Timeout':
'Apache_Rpm_KeepAlive':
'Apache_Rpm_MaxKeepAliveRequests':
'Apache_Rpm_KeepAliveTimeout':
'Apache_Rpm_Listen':
'Apache_Rpm_User':
'Apache_Rpm_Group':
'Apache_Rpm_ServerAdmin':
'Apache_Rpm_UseCanonicalName':
'Apache_Rpm_DocumentRoot':
'Apache_Rpm_HostnameLookups':
'Apache_Rpm_ErrorLog':
'Apache_Rpm_ServerSignature':
'Apache_Rpm_LogLevel':
'Apache_Rpm_Log_Segmentation':
'Apache_Rpm_Vhost'
'Apache_Rpm_Vhost_Conf':
'Apache_Make_ServerTokens':
'Apache_Make_ServerRoot':
'Apache_Make_PidFile':
'Apache_Make_Timeout':
'Apache_Make_KeepAlive':
'Apache_Make_MaxKeepAliveRequests':
'Apache_Make_KeepAliveTimeout':
'Apache_Make_Listen':
'Apache_Make_User':
'Apache_Make_Group':
'Apache_Make_ServerAdmin':
'Apache_Make_UseCanonicalName':
'Apache_Make_DocumentRoot':
'Apache_Make_HostnameLookups':
'Apache_Make_ErrorLog':
'Apache_Make_ServerSignature':
'Apache_Make_LogLevel':
'Apache_Make_Log_Segmentation':
'Apache_Make_Vhost'
'Apache_Make_Vhost_Conf':
			}
}



########################
#第二、Nginx信息
########################

#判断nginx是否安装，安装为“ON”，未安装为“OFF”
nginx_install
#判断apache的安装方式，RPM/APT或MAKE
nginx_install_way
#检测nginx的安装版本
nginx_version
#检测nginx启动关闭命令的绝对路径
start_path
stop_path
restart_path
#检测nginx的主配置文件的路径
conf_path
#检测nginx的vhost的路径,多个文件之间使用":"隔开
vhost_conf
#全局配置
user  nginx;
worker_processes  1;

nginx是否配置了日志分割

nginx是否支持防范域名恶意解析？

nginx是否开启了gzip压缩

nginx是否安装了安全模块





使用apachectl验证配置文件的正确性

#检测apache的vhost的路径,多个文件之间使用":"隔开
vhost_conf

NameVirtualHost *:80
#<VirtualHost *:80>
#    ServerAdmin webmaster@dummy-host.example.com
#    DocumentRoot /www/docs/dummy-host.example.com
#    ServerName dummy-host.example.com
#    ErrorLog logs/dummy-host.example.com-error_log
#    CustomLog logs/dummy-host.example.com-access_log common
#</VirtualHost>

/etc/passwd 的文件属性
/etc/group的文件属性
锁定的帐号的列表
ssh是否禁用了dns解析
是否安装了chkrootkit
是否安装了rkhunter？
是否安装了防范DDoS攻击的软件？
是否安装了logwatch?
是否安装了logcheck?
是否配置了磁盘空间检测报警



是否启用了日志分割            OK

是否ssh启用了防范域名恶意解析？

是否开启了gzip压缩？

是否开启了静态内容缓存？

是否限定了日志文件的大小？

是否禁用了目录列表？
是否限制了请求大小？
是否启用了ssl证书？
屏蔽了哪些恶意蜘蛛？





###########################
#第三、PHP信息
###########################

#判断PHP是否安装，安装为“ON”，未安装为“OFF”
nginx_install
#判断PHP的安装方式，RPM/APT或MAKE
nginx_install_way
#检测PHP的安装版本
nginx_version
#检测PHP启动关闭命令的绝对路径
start_path
stop_path
restart_path
#检测PHP的主配置文件的路径
conf_path
#列出PHP的主要设置项

engine = On

short_open_tag = Off

asp_tags = Off

precision = 14

y2k_compliance = On

output_buffering = 4096

zlib.output_compression = Off

implicit_flush = Off

unserialize_callback_func =

serialize_precision = 100

allow_call_time_pass_reference = Off

safe_mode = Off

safe_mode_gid = Off

safe_mode_include_dir =

safe_mode_exec_dir =

safe_mode_allowed_env_vars = PHP_

safe_mode_protected_env_vars = LD_LIBRARY_PATH

disable_functions =

disable_classes =

expose_php = On

max_execution_time = 30     

max_input_time = 60

memory_limit = 128M

error_reporting = E_ALL & ~E_DEPRECATED

display_errors = Off

display_startup_errors = Off

log_errors = On

log_errors_max_len = 1024

ignore_repeated_errors = Off

ignore_repeated_source = Off

report_memleaks = On

track_errors = Off

html_errors = Off

variables_order = "GPCS"

request_order = "GP"

register_globals = Off

register_long_arrays = Off

register_argc_argv = Off

auto_globals_jit = On

post_max_size = 8M

magic_quotes_gpc = Off

magic_quotes_runtime = Off

magic_quotes_sybase = Off

auto_prepend_file =

auto_append_file =

default_mimetype = "text/html"

doc_root =

user_dir =

enable_dl = Off


file_uploads = On

upload_max_filesize = 2M

allow_url_fopen = On

allow_url_include = Off

default_socket_timeout = 60

[Date]

[filter]

[iconv]

[intl]

[sqlite]

[sqlite3]

[Pcre]

[Pdo]

[Phar]

[Syslog]
define_syslog_variables  = Off

[mail function]
SMTP = localhost
smtp_port = 25

sendmail_path = /usr/sbin/sendmail -t -i

mail.add_x_header = On

[SQL]
sql.safe_mode = Off

[ODBC]

odbc.allow_persistent = On

odbc.check_persistent = On

odbc.max_persistent = -1

odbc.max_links = -1

odbc.defaultlrl = 4096

odbc.defaultbinmode = 1


[MySQL]
mysql.allow_persistent = On

mysql.max_persistent = -1

mysql.max_links = -1

mysql.default_port =

mysql.default_socket =

mysql.default_host =

mysql.default_user =

mysql.default_password =

mysql.connect_timeout = 60

mysql.trace_mode = Off

[MySQLi]

mysqli.max_links = -1

mysqli.default_port = 3306

mysqli.default_socket =

mysqli.default_host =

mysqli.default_user =

mysqli.default_pw =

mysqli.reconnect = Off

[PostgresSQL]
pgsql.allow_persistent = On

pgsql.auto_reset_persistent = Off

pgsql.max_persistent = -1

pgsql.max_links = -1

pgsql.ignore_notice = 0

pgsql.log_notice = 0

[Sybase-CT]
sybct.allow_persistent = On

sybct.max_persistent = -1

sybct.max_links = -1

sybct.min_server_severity = 10

sybct.min_client_severity = 10


[bcmath]
bcmath.scale = 0

[browscap]

[Session]
session.save_handler = files

session.save_path = "/var/lib/php/session"

session.use_cookies = 1

session.use_only_cookies = 1

session.name = PHPSESSID

session.auto_start = 0

session.cookie_lifetime = 0

session.cookie_path = /

session.cookie_domain =

session.cookie_httponly = 

session.serialize_handler = php

session.gc_probability = 1

session.gc_divisor = 1000

session.gc_maxlifetime = 1440


session.bug_compat_42 = Off

session.bug_compat_warn = Off

session.referer_check =

session.entropy_length = 0

session.entropy_file =

session.cache_limiter = nocache

session.cache_expire = 180

session.use_trans_sid = 0

session.hash_function = 0

session.hash_bits_per_character = 5

url_rewriter.tags = "a=href,area=href,frame=src,input=src,form=fakeentry"

[MSSQL]
mssql.allow_persistent = On

mssql.max_persistent = -1

mssql.max_links = -1

mssql.min_error_severity = 10

mssql.min_message_severity = 10

mssql.compatability_mode = Off

mssql.secure_connection = Off


[Assertion]

[COM]

[mbstring]

[gd]

[exif]

[Tidy]

tidy.clean_output = Off

[soap]

soap.wsdl_cache_enabled=1

soap.wsdl_cache_dir="/tmp"

soap.wsdl_cache_ttl=86400

[sysvshm]

######################
#第四、MySql信息
######################

#判断Mysql是否安装，安装为“ON”，未安装为“OFF”
mysql_install
#判断Mysql的安装方式，RPM/APT或MAKE
mysql_install_way
#检测Mysql的安装版本
mysql_version
#检测Mysql启动关闭命令的绝对路径
start_path
stop_path
restart_path
#检测Mysql的主配置文件的路径
conf_path
#列出Mysql的主要设置项
[mysqld]
port            = 3306
socket          = /var/lib/mysql/mysql.sock
skip-locking
key_buffer_size = 16M
max_allowed_packet = 1M
table_open_cache = 64
sort_buffer_size = 512K
net_buffer_length = 8K
read_buffer_size = 256K
read_rnd_buffer_size = 512K
myisam_sort_buffer_size = 8M
