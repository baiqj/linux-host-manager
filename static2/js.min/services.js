angular.module("vpsmate.services",[]).factory("Auth",["$rootScope","$http","$location",function(a,d,c){var b={};b.required=function(f,e){d.post("/authstatus").success(function(g){if(f){f.call(null,g.authed=="yes")}if(g.authed=="no"){a.loginto=c.path();a.loginto_section=c.search().s;if(a.loginto=="/"||a.loginto=="/logout"){a.loginto="/main";a.loginto_section=""}c.path("/");c.search("s",null)}}).error(function(h,g){if(e){e.call(null,g)}})};b.getlastactive=function(e){d.get("/authstatus?"+Math.random()).success(function(f){if(e){e.call(null,f.lastactive)}})};return b}]).factory("Module",["$rootScope","$location",function(a,c){var b={};b.init=function(e,d){a.module=e;a.htmlTitle=d};b.initSection=function(d){var e=c.search().s;a.activeTabName=e?e:d};b.getSection=function(){return c.search().s};b.setSection=function(d){a.activeTabName=d};b.getParam=function(d){return c.search()[d]};return b}]).factory("Timeout",["$rootScope","$timeout",function(a,b){var c=function(g,f,e,h,d){if(e&&a.module!=e){return}if(h&&a[d]){return}if(!d){d="timeout"}a[d]=b(function(){if(a[d]){delete a[d]}if(!e||a.module==e){g.call()}},f)};return c}]).factory("Message",["$rootScope","$timeout",function(b,d){var c={};b.showSuccessMsg=false;b.showErrorMsg=false;b.showWarningMsg=false;b.showInfoMsg=false;b.msgTimeout=0;var a=function(){if(b.msgTimeout){d.cancel(b.msgTimeout)}b.msgTimeout=d(function(){b.showSuccessMsg=false;b.showErrorMsg=false;b.showInfoMsg=false;b.msgTimeout=0},5000)};c.setSuccess=function(f,e){b.successMessage=f;if(f){b.showSuccessMsg=true;b.showErrorMsg=false;b.showInfoMsg=false;if(!e){a()}}else{b.showSuccessMsg=false;b.showErrorMsg=false;b.showInfoMsg=false}};c.setError=function(f,e){b.errorMessage=f;if(f){b.showSuccessMsg=false;b.showErrorMsg=true;b.showInfoMsg=false;if(!e){a()}}else{b.showSuccessMsg=false;b.showErrorMsg=false;b.showInfoMsg=false}};c.setInfo=function(f,e){b.infoMessage=f;if(f){b.showSuccessMsg=false;b.showErrorMsg=false;b.showInfoMsg=true;if(!e){a()}}else{b.showSuccessMsg=false;b.showErrorMsg=false;b.showInfoMsg=false}};c.setWarning=function(f,e){b.warningMessage=f;if(f){b.showWarningMsg=true;if(!e){a()}}else{b.showWarningMsg=false}};return c}]).factory("Request",["$http","$rootScope","$location","$timeout","Message",function(h,a,g,d,c){var b={};var f=function(j,i){return function(k){a.processing=false;if(!i&&k.msg){if(k.code==0){c.setSuccess(k.msg)}else{if(k.code==-1){c.setError(k.msg)}else{if(k.code==1){c.setWarning(k.msg)}else{if(k.code==2){c.setInfo(k.msg)}}}}}if(j){j.call(null,k)}}};var e=function(j,i){return function(l,k){a.processing=false;if(!i&&j){if(!j.call(null,l,k)){return}}if(k==403){c.setError("登录无效或超时，请重新登录。",true);a.loginto=g.path();a.loginto_section=g.search().s;if(a.loginto=="/"||a.loginto=="/logout"){a.loginto="/main";a.loginto_section=""}g.path("/");g.search("s",null)}else{c.setError("发生未知错误！")}}};b.setProcessing=function(i){a.processing=i};b.get=function(l,m,i,k){a.processing=true;var j=a.$proxyroot+l;if(j.indexOf("?")>0){j+="&"+Math.random()}else{j+="?"+Math.random()}h.get(j).success(f(m,k)).error(e(i,k))};b.post=function(k,l,m,i,j){a.processing=true;h.post(a.$proxyroot+k,l).success(f(m,j)).error(e(i,j))};return b}]).factory("Backend",["Timeout","Request",function(c,b){var a={};a.call=function(d,g,f,j,h,i,e){d.waiting=true;b.post(f,h,function(k){if(k.code==-1){if(i){if(typeof i.error=="function"){i.error.call(null,k.data)}}return}var l=function(){b.get(j,function(m){if(m.status=="finish"){d.waiting=false;if(m.code==0){if(i){if(typeof i=="function"){i.call(null,m)}else{if(typeof i.success=="function"){i.success.call(null,m)}}}}else{if(i){if(typeof i=="function"){i.call(null,m)}else{if(typeof i.error=="function"){i.error.call(null,m)}}}}}else{if(i){if(typeof i.wait=="function"){i.wait.call(null,m)}}c(l,500,g)}},false,e)};c(l,500,g)},function(k){if(i){if(typeof i.error=="function"){i.error.call(null,k)}}})};return a}]);